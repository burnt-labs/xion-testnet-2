# Xion v24 Release Notes

## Overview

The Xion v24 series introduces critical protobuf schema compatibility fixes to resolve contract data corruption issues from previous versions. This release focuses on safely migrating contract data, improving upgrade handling, expanding E2E test coverage, and enhancing documentation. The recommended version is v24.0.0.

## What's Changed

### v24.0.0

#### Critical Contract Data Migration

- **Protobuf Schema Fix**: Resolves wire type compatibility issues that caused contract data corruption in v20/v21/v23 versions
- **Smart Migration Logic**: Automatically detects and migrates contracts with field ordering issues using field 8 presence detection (not version/block height)
- **Field Swap Operation**: Safely swaps protobuf fields 7↔8 while preserving wire types for contracts with broken schemas
- **Universal Approach**: Handles all schema versions correctly:
  - Pre-v20 (SchemaLegacy): No migration needed
  - v20/v21/v23 (SchemaBroken): Swap fields 7↔8, clear field 8
  - v22 (SchemaCanonical): No migration needed
- **Performance**: Achieves 280,000+ contracts/second migration speed (~21 seconds for 6M contracts)

#### Upgrade Handling Improvements

- **V24 Upgrade Handler**: Updated upgrade handler in `app/upgrades.go` to run v24-specific contract migration logic
- **Upgrade Name Updated**: Changed const `UpgradeName` to "v24" for proper upgrade identification
- **Post-Migration Step**: Added migration step after module migrations to ensure contract data integrity

#### Testing and CI/CD Enhancements

- **Expanded E2E Test Coverage**: Added comprehensive v24 upgrade scenario tests with 89.9% code coverage
- **Test Matrix Expansion**: Updated `.github/workflows/e2e-tests.yaml` to include:
  - AASingleMigration tests
  - AppTreasuryGrants tests
  - All Indexer* tests
  - Comprehensive upgrade and indexer functionality coverage
- **227 Total Tests**: Across all test files with ≥50% coverage for all functions
- **Idempotency Testing**: Ensures migration can be safely re-run without issues
- **Performance Validation**: Tests at mainnet scale (6M contracts)

#### Configuration Updates

- **Linting Configuration**: Updated `.golangci.yml` to exclude G115 rule in gosec to prevent false positives
- **Workflow Updates**: Updated workflow steps and environment variables to use new docker image naming conventions (`docker-*` instead of `heighliner-*`)
- **Image Tag Updates**: Set correct image tags for v24 upgrade in CI/CD pipeline

#### Key Technical Details

- **Detection Strategy**: Uses field 8 of ContractInfo presence check (not version/block height) for reliable schema detection
- **Wire Type Preservation**: Maintains wire type 2 (length-delimited) during field swapping to ensure binary compatibility
- **Safe Migration**: Clears field 8 after swap (IBCv2 not in use)
- **Comprehensive Validation**: Validates all migrated contracts for correctness

## Upgrade Information

- **Release Date**: November 12, 2025
- **Upgrade Height**: [9,500,000](https://www.mintscan.io/xion-testnet/blocks/9500000) (testnet)
- **Proposal Number**: [045](https://www.mintscan.io/xion-testnet/proposals/045) (Expedited)
- **Chain ID**: xion-testnet-2 (in-place migration)

## Release Links

- **v24.0.0**: [GitHub Release](https://github.com/burnt-labs/xion/releases/tag/v24.0.0)

## Contributors

Special thanks to the following contributors who made this release possible:

- [@2xburnt](https://github.com/2xburnt)

## Full Changelog

[v23.0.0...v24.0.0](https://github.com/burnt-labs/xion/compare/v23.0.0...v24.0.0)

---

For more information about the upgrade process, please refer to the [upgrade proposal](../proposals/045-upgrade-v24.json).

## Important Notes

- **Critical Security Release**: Fixes contract data corruption from v20/v21/v23 protobuf schema issues
- **Automatic Migration**: All affected contracts will be automatically migrated during the upgrade
- **Safe to Re-run**: Migration is idempotent and safe to execute multiple times
- **Backup Required**: Ensure you backup your validator state before upgrading


